<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Sudoku</title>

<style>
/* *{
    outline: 1px solid red;
} */

body{
    font-family: Arial, sans-serif;
    background:#f2f2f2;
    display:flex;
    justify-content:center;
    margin-top:30px;
}

.game{
    background:#fff;
    padding:20px;
    border-radius:8px;
    box-shadow:0 0 10px rgba(0,0,0,.15);
}

/* ===== L∆Ø·ªöI CHU·∫®N ===== */
table{
    border-collapse:collapse;
    border:4px solid #000;
}

td{
    width:42px;
    height:42px;
    border:1px solid #999;
    padding:0;
}

/* Vi·ªÅn d·ªçc kh·ªëi 3x3 */
td:nth-child(3),
td:nth-child(6){
    border-right:4px solid #000;
}

/* Vi·ªÅn ngang kh·ªëi 3x3 */
tr:nth-child(3) td,
tr:nth-child(6) td{
    border-bottom:4px solid #000;
}

/* INPUT KH√îNG ƒê∆Ø·ª¢C CHE VI·ªÄN */
input{
    width:100%;
    height:100%;
    box-sizing:border-box;
    border:none;
    outline:none;
    text-align:center;
    font-size:20px;
    background:transparent;
}

/* ===== TR·∫†NG TH√ÅI ===== */
.fixed{
    background:#eaeaea;
    font-weight:bold;
}

.correct{
    background:#b6f0b6 !important;
}

.wrong{
    background:#f5b5b5 !important;
}

button{
    margin-top:10px;
    /* margin-right:6px; */
    padding:6px 12px;
    cursor:pointer;
}

.top-bar{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    margin-bottom:8px;
}

#status{
    margin-top:8px;
    font-weight:bold;
    transform: translateY(10px);
}

.title{
    display:flex;
    align-items:center;
    gap:8px;
}

.help-btn{
    border:none;
    background:#eee;
    cursor:pointer;
    font-size:16px;
    border-radius:5px;
    /* width:26px;
    height:26px; */
    transform: translateY(-5px);
}

.help-btn:hover{
    background:#ddd;
}

.help-box{
    display:none;
    margin-bottom:10px;
    padding:10px;
    background:#f9f9f9;
    border-left:4px solid #333;
    font-size:14px;
}

.help-box ul{
    margin:6px 0 0 18px;
}
.control-bar{
    display:flex;
    justify-content:space-between;
    margin-top:12px;
}
.mistakes{
    padding:4px 10px;
    border-radius:6px;
    font-weight:bold;
    min-width:60px;
    text-align:center;
}

.mistakes.safe{
    background:#d6f5d6;
    color:#1b7a1b;
}

.mistakes.warning{
    background:#ffd6d6;
    color:#a30000;
}

textarea{
    text-align:center;
}

/* ===== WIN BANNER ===== */
.win-banner{
    position:absolute;
    inset:0;
    background:rgba(0,0,0,0.55);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:10;
    border-radius:8px;
}

.win-content{
    background:#fff;
    padding:25px 35px;
    border-radius:12px;
    text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,.3);
    animation: pop .4s ease;
}

.win-content h2{
    margin:0 0 10px;
    color:#2e7d32;
}

.win-content p{
    margin-bottom:15px;
    font-size:16px;
}

.win-content button{
    /* padding:8px 16px;
    font-size:15px; */
    cursor:pointer;
}

@keyframes pop{
    from{ transform:scale(.7); opacity:0; }
    to{ transform:scale(1); opacity:1; }
}

/* game c·∫ßn position ƒë·ªÉ banner ph·ªß */
.game{
    position:relative;
}

.play-area{
    display:flex;
    gap:12px;
    align-items:stretch;
}

.note{
    width:120px;
    resize:none;
    font-size:14px;
    padding:8px;
    line-height:1.5;
}

</style>
</head>

<body>
<div class="game">
    <!-- <h3>Sudoku</h3> -->
    <div class="top-bar">
        <div class="title">
            <h3>Sudoku</h3>
            <button class="help-btn" onclick="toggleHelp()">Rule</button>
        </div>

        <div id="status" class="mistakes"></div>
    </div>
    <div id="help" class="help-box">
    <strong>C√°ch ch∆°i Sudoku</strong>
    <ul>
        <li>ƒêi·ªÅn c√°c s·ªë t·ª´ <b>1 ƒë·∫øn 9</b> v√†o √¥ tr·ªëng.</li>
        <li>M·ªói h√†ng, m·ªói c·ªôt v√† m·ªói kh·ªëi <b>3√ó3</b> kh√¥ng ƒë∆∞·ª£c tr√πng s·ªë.</li>
        <li>Nh·∫•n <b>Ki·ªÉm tra</b> ƒë·ªÉ xem k·∫øt qu·∫£.</li>
        <li>B·∫°n ch·ªâ ƒë∆∞·ª£c ph√©p sai <b>3 l·∫ßn</b>.</li>
        <li>Sai qu√° 3 l·∫ßn ‚Üí thua, h√£y nh·∫•n <b>New</b>.</li>
    </ul>
</div>
    <div id="winBanner" class="win-banner">
        <div class="win-content">
            <h2>üéâ Ch√∫c m·ª´ng!</h2>
            <button onclick="newGame()">Play</button>
        </div>
    </div>
    <div class="play-area">
        <table id="board"></table>

        <textarea class="note"
            placeholder="Note"></textarea>
    </div>
    <div class="control-bar">
        <button onclick="check()">Check</button>
        <button onclick="newGame()">New</button>
    </div>
    <p id="msg"></p>
</div>

<script>
let solution=[], puzzle=[];
let mistakes=0;
const MAX=3;
let gameOver=false;

/* ===== SINH B·∫¢NG ===== */
function shuffle(a){
    for(let i=a.length-1;i>0;i--){
        let j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
    }
    return a;
}

function safe(b,r,c,n){
    for(let i=0;i<9;i++)
        if(b[r][i]==n||b[i][c]==n) return false;
    let br=Math.floor(r/3)*3, bc=Math.floor(c/3)*3;
    for(let i=0;i<3;i++)
        for(let j=0;j<3;j++)
            if(b[br+i][bc+j]==n) return false;
    return true;
}

function solve(b){
    for(let r=0;r<9;r++)
        for(let c=0;c<9;c++)
            if(b[r][c]==0){
                for(let n of shuffle([1,2,3,4,5,6,7,8,9])){
                    if(safe(b,r,c,n)){
                        b[r][c]=n;
                        if(solve(b)) return true;
                        b[r][c]=0;
                    }
                }
                return false;
            }
    return true;
}

function generate(){
    let b=Array.from({length:9},()=>Array(9).fill(0));
    solve(b);
    return b;
}

// blanks: TƒÉng ƒë·ªô kh√≥
function makePuzzle(full, blanks=35){
    let p=full.map(r=>r.slice());
    while(blanks){
        let r=Math.random()*9|0, c=Math.random()*9|0;
        if(p[r][c]!=0){ p[r][c]=0; blanks--; }
    }
    return p;
}

/* ===== V·∫º B·∫¢NG ===== */
function draw(){
    const t=document.getElementById("board");
    t.innerHTML="";
    for(let r=0;r<9;r++){
        let tr=document.createElement("tr");
        for(let c=0;c<9;c++){
            let td=document.createElement("td");
            let i=document.createElement("input");
            i.maxLength=1;

            if(puzzle[r][c]){
                i.value=puzzle[r][c];
                i.disabled=true;
                i.classList.add("fixed");
            }else{
                i.oninput=()=>{ if(!/[1-9]/.test(i.value)) i.value=""; };
            }

            td.appendChild(i);
            tr.appendChild(td);
        }
        t.appendChild(tr);
    }
}

/* ===== KI·ªÇM TRA ===== */
function check(){
    if(gameOver) return;

    const inputs = document.querySelectorAll("input");
    let idx = 0;
    let solved = true;
    let hasWrong = false;

    inputs.forEach(i => i.classList.remove("correct","wrong"));

    for(let r = 0; r < 9; r++){
        for(let c = 0; c < 9; c++){
            const input = inputs[idx++];

            if(input.disabled) continue;

            if(!input.value){
                solved = false;
                continue;
            }

            if(+input.value === solution[r][c]){
                input.classList.add("correct");
            }else{
                input.classList.add("wrong");
                solved = false;
                hasWrong = true;
            }
        }
    }

    if(solved){
        gameOver = true;
        document.getElementById("winBanner").style.display = "flex";
        document.querySelectorAll("input").forEach(i => i.disabled = true);
        return;
    }

    if(hasWrong){
        mistakes++;
        update();

        if(mistakes >= MAX){
            gameOver = true;
            document.querySelectorAll("input").forEach(i => i.disabled = true);
            return;
        }
    }

    setTimeout(()=>{
        inputs.forEach(i => i.classList.remove("correct","wrong"));
    },700);
}

function update(){
    const remain = MAX - mistakes;
    const status = document.getElementById("status");

    status.textContent = `${remain} / ${MAX}`;

    status.classList.remove("safe", "warning");

    if (remain >= 2) {
        status.classList.add("safe");
    } else {
        status.classList.add("warning");
    }
}


function newGame(){
    solution = generate();
    puzzle = makePuzzle(solution);
    mistakes = 0;
    gameOver = false;

    draw();
    update();

    document.getElementById("msg").textContent = "";
    document.getElementById("winBanner").style.display = "none";
}

function toggleHelp(){
    const h = document.getElementById("help");
    h.style.display = (h.style.display === "block") ? "none" : "block";
}

newGame();
</script>
</body>
</html>